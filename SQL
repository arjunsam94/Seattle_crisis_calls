USE DATABASE GROUP_PROJECT_TEAM9;

SELECT * FROM CRISIS_CALLS_DATA limit 10;

-- Queries for slides

-- Trends of 911 calls

SELECT YEAR(REPORTED_DATE) AS CRISIS_YEAR, 
COUNT(*) AS CASES_COUNT 
FROM CRISIS_CALLS_DATA 
WHERE CALL_TYPE = '911' 
GROUP BY CRISIS_YEAR 
ORDER BY CRISIS_YEAR ASC;

SELECT MONTH(REPORTED_DATE) AS CRISIS_MONTH, 
COUNT(*) AS CASES_COUNT 
FROM CRISIS_CALLS_DATA 
WHERE CALL_TYPE = '911' 
GROUP BY CRISIS_MONTH 
ORDER BY CRISIS_MONTH ASC;

SELECT HOUR(REPORTED_TIME) AS reported_hour, 
COUNT(*) AS calls 
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911'
GROUP BY reported_hour
ORDER BY reported_hour ASC;

SELECT YEAR(REPORTED_DATE) AS case_year, 
COUNT(DISTINCT officer_id) AS officer_count
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911'
GROUP BY case_year
ORDER BY case_year ASC;

SELECT MONTH(REPORTED_DATE) AS CRISIS_MONTH, 
COUNT(DISTINCT officer_id) AS officer_COUNT 
FROM CRISIS_CALLS_DATA 
WHERE CALL_TYPE = '911' 
GROUP BY CRISIS_MONTH 
ORDER BY CRISIS_MONTH ASC;

SELECT HOUR(REPORTED_TIME) AS CRISIS_HOUR, 
COUNT(DISTINCT officer_id) AS officer_count 
FROM CRISIS_CALLS_DATA 
WHERE CALL_TYPE = '911' 
GROUP BY CRISIS_HOUR 
ORDER BY CRISIS_HOUR ASC;

-- Top 10 911 calls

SELECT INITIAL_CALL_TYPE, COUNT(*) AS call_type_count
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911'
GROUP BY INITIAL_CALL_TYPE
ORDER BY call_type_count DESC
LIMIT 10;

-- Call type

SELECT INITIAL_CALL_TYPE, COUNT(*) AS call_type_count
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911'
GROUP BY INITIAL_CALL_TYPE
ORDER BY call_type_count DESC
LIMIT 10;

-- Use of force 
SELECT INITIAL_CALL_TYPE, COUNT(*) AS call_type_count
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911' AND USE_OF_FORCE_INDICATOR = 'Y'
GROUP BY INITIAL_CALL_TYPE
ORDER BY call_type_count DESC
LIMIT 10;

SELECT officer_id, COUNT(*) AS cases_handled
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911'
GROUP BY officer_id
ORDER BY cases_handled DESC
LIMIT 10;

-- 911 cases handled in each sector and officer experience

SELECT SECTOR, COUNT(*) AS sector_911_count
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911'
GROUP BY SECTOR
ORDER BY sector_911_count DESC;

SELECT SECTOR, AVG(officer_years_of_experience) AS sector_wise_officer_experience
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911'
GROUP BY SECTOR
ORDER BY sector_wise_officer_experience ASC;

-- Use of force indicator

SELECT SECTOR, COUNT(USE_OF_FORCE_INDICATOR) AS sector_wise_use_of_force
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911' AND USE_OF_FORCE_INDICATOR = 'Y'
GROUP BY SECTOR
ORDER BY sector_wise_use_of_force DESC;

SELECT SECTOR, COUNT(USE_OF_FORCE_INDICATOR) AS sector_wise_use_of_force
FROM CRISIS_CALLS_DATA
WHERE USE_OF_FORCE_INDICATOR = 'Y'
GROUP BY SECTOR
ORDER BY sector_wise_use_of_force DESC;

SELECT SECTOR, COUNT(*) AS sector_wise_no_action
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911' AND DISPOSITION = 'No Action Possible / Necessary'
GROUP BY SECTOR
ORDER BY sector_wise_no_action DESC;

-- average cases handled per officer in each sector

SELECT SECTOR, (COUNT(*)/COUNT(DISTINCT OFFICER_ID)) AS sector_wise_avg_cases
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911'
GROUP BY SECTOR
ORDER BY sector_wise_avg_cases DESC;

SELECT YEAR(REPORTED_DATE) AS CASE_YEAR, (COUNT(*)/COUNT(DISTINCT OFFICER_ID)) AS sector_wise_avg_cases
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911' AND (SECTOR = 'KING' OR SECTOR = 'EDWARD')
GROUP BY CASE_YEAR
ORDER BY CASE_YEAR ASC;

SELECT SECTOR, COUNT(DISTINCT OFFICER_ID) AS sector_wise_officers
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911'
GROUP BY SECTOR
ORDER BY sector_wise_officers DESC;

--Sectors handled by each officer
SELECT officer_id, COUNT(DISTINCT SECTOR) AS SECTOR
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911'
GROUP BY officer_id;

--Utilization

SELECT FINAL_CALL_TYPE, AVG(officer_years_of_experience) AS officer_experience
FROM crisis_calls_data
GROUP BY FINAL_CALL_TYPE
ORDER BY officer_experience DESC
LIMIT 25;

WITH case_trend AS
(SELECT
YEAR(REPORTED_DATE) AS CASE_YEAR,
COUNT(FINAL_CALL_TYPE) AS CALL_COUNT,
RANK() OVER (PARTITION BY CASE_YEAR ORDER BY CALL_COUNT DESC) AS CALL_RANK
FROM CRISIS_CALLS_DATA
GROUP BY CASE_YEAR)

SELECT
CASE_YEAR,
CALL_COUNT,
CALL_RANK
FROM case_trend
WHERE CALL_RANK <= 2;

SELECT
    SUM(CASE WHEN CIT_OFFICER_DISPATCHED = 'Y' THEN 1 ELSE 0 END) AS CITDispatchedCount,
    (CITDispatchedCount * 100.0) / (SELECT COUNT(*) FROM CRISIS_CALLS_DATA) AS Percentage
FROM CRISIS_CALLS_DATA;

SELECT
    YEAR(REPORTED_DATE) AS CASE_YEAR,
    SUM(CASE WHEN CIT_OFFICER_DISPATCHED = 'Y' THEN 1 ELSE 0 END) AS CITDispatchedCount,
    (CITDispatchedCount * 100.0) / (SELECT COUNT(*) FROM CRISIS_CALLS_DATA) AS Percentage
FROM CRISIS_CALLS_DATA
GROUP BY CASE_YEAR
ORDER BY CASE_YEAR;

SELECT
    INITIAL_CALL_TYPE AS CASE_TYPE,
    SUM(CASE WHEN CIT_OFFICER_DISPATCHED = 'Y' THEN 1 ELSE 0 END) AS CITDispatchedCount,
    (CITDispatchedCount * 100.0) / (SELECT COUNT(*) FROM CRISIS_CALLS_DATA) AS Percentage
FROM CRISIS_CALLS_DATA
GROUP BY CASE_TYPE
ORDER BY Percentage DESC
LIMIT 10;

SELECT YEAR(REPORTED_DATE) AS CRISIS_YEAR, 
COUNT(*) AS CASES_COUNT
FROM CRISIS_CALLS_DATA 
WHERE USE_OF_FORCE_INDICATOR = 'Y'
GROUP BY CRISIS_YEAR 
ORDER BY CRISIS_YEAR ASC;

SELECT YEAR(REPORTED_DATE) AS case_year, 
COUNT(DISTINCT officer_id) AS officer_count
FROM CRISIS_CALLS_DATA
WHERE CALL_TYPE = '911' AND (SECTOR = 'KING' OR SECTOR = 'EDWARD')
GROUP BY case_year
ORDER BY case_year ASC;


WITH SECTOR_FORCE_USE AS (SELECT SECTOR, COUNT(*) AS FORCE_USE_COUNT 
FROM CRISIS_CALLS_DATA 
WHERE USE_OF_FORCE_INDICATOR = 'Y' 
GROUP BY SECTOR)

SELECT C.SECTOR, COUNT(*) AS CASE_COUNT, S.FORCE_USE_COUNT
FROM CRISIS_CALLS_DATA C
JOIN SECTOR_FORCE_USE S ON C.SECTOR = S.SECTOR
GROUP BY C.SECTOR, S.FORCE_USE_COUNT
ORDER BY CASE_COUNT DESC;

SELECT PRECINCT, COUNT(*) AS CASE_COUNT
FROM CRISIS_CALLS_DATA
GROUP BY PRECINCT
ORDER BY CASE_COUNT DESC
LIMIT 5;

SELECT CALL_TYPE, COUNT(*) AS CASE_COUNT
FROM CRISIS_CALLS_DATA
GROUP BY CALL_TYPE
ORDER BY CASE_COUNT DESC;

SELECT HOUR(REPORTED_TIME) AS reported_hour, COUNT(*) as CASE_COUNT
FROM CRISIS_CALLS_DATA
GROUP BY reported_hour
ORDER BY reported_hour;

SELECT OFFICER_GENDER, COUNT(*) AS OFFICER_COUNT
FROM CRISIS_CALLS_DATA
GROUP BY OFFICER_GENDER;

SELECT DISPOSITION, COUNT(*) AS CASE_COUNT
FROM CRISIS_CALLS_DATA
GROUP BY DISPOSITION;

SELECT YEAR(REPORTED_DATE) AS CASE_YEAR, COUNT(*) AS suicide_cases
FROM CRISIS_CALLS_DATA
WHERE INITIAL_CALL_TYPE LIKE '%SUICIDE%'
GROUP BY CASE_YEAR;

SELECT YEAR(REPORTED_DATE) AS CASE_YEAR, INITIAL_CALL_TYPE, COUNT(*) AS CASE_COUNT
FROM CRISIS_CALLS_DATA
GROUP BY CASE_YEAR, INITIAL_CALL_TYPE
HAVING MAX(CASE_COUNT);

SELECT DISPOSITION, COUNT(*) AS CASE_COUNT
FROM CRISIS_CALLS_DATA
WHERE USE_OF_FORCE_INDICATOR = 'Y'
GROUP BY DISPOSITION;

SELECT SECTOR, COUNT(*) AS sector_wise_use_of_force
FROM CRISIS_CALLS_DATA
WHERE USE_OF_FORCE_INDICATOR = 'Y'
GROUP BY SECTOR
ORDER BY sector_wise_use_of_force DESC;

SELECT YEAR(REPORTED_DATE) AS YEAR_DATE, COUNT(*) AS case_count
FROM CRISIS_CALLS_DATA
WHERE USE_OF_FORCE_INDICATOR = 'Y'
GROUP BY YEAR_DATE
ORDER BY YEAR_DATE;


SELECT YEAR(REPORTED_DATE) AS REPORTED_YEAR, (COUNT(*)/COUNT(DISTINCT OFFICER_ID)) AS cases_per_officer
FROM CRISIS_CALLS_DATA
WHERE USE_OF_FORCE_INDICATOR = 'Y' AND CIT_CERTIFIED_INDICATOR = 'Y'
GROUP BY REPORTED_YEAR
ORDER BY REPORTED_YEAR;

SELECT YEAR(REPORTED_DATE) AS REPORTED_YEAR, (COUNT(*)/COUNT(DISTINCT OFFICER_ID)) AS cases_per_officer
FROM CRISIS_CALLS_DATA
WHERE USE_OF_FORCE_INDICATOR = 'Y'
GROUP BY REPORTED_YEAR
ORDER BY REPORTED_YEAR;

WITH with_certification AS(SELECT INITIAL_CALL_TYPE, COUNT(DISTINCT OFFICER_ID) AS certified_officers
FROM CRISIS_CALLS_DATA
WHERE CIT_CERTIFIED_INDICATOR = 'Y'
GROUP BY INITIAL_CALL_TYPE)

SELECT W.INITIAL_CALL_TYPE, W.certified_officers, COUNT(DISTINCT A.OFFICER_ID) AS uncertified_officers
FROM with_certification W
RIGHT JOIN CRISIS_CALLS_DATA A ON W.INITIAL_CALL_TYPE = A.INITIAL_CALL_TYPE
WHERE A.CIT_CERTIFIED_INDICATOR != 'Y'
GROUP BY W.INITIAL_CALL_TYPE,W.certified_officers
ORDER BY uncertified_officers DESC
LIMIT 10;

SELECT INITIAL_CALL_TYPE, COUNT(DISTINCT OFFICER_ID) AS certified_officers
FROM CRISIS_CALLS_DATA
WHERE CIT_CERTIFIED_INDICATOR = 'Y'
GROUP BY INITIAL_CALL_TYPE
ORDER BY certified_officers DESC;
